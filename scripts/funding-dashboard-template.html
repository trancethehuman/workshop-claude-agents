<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Startup Funding Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,300;1,9..40,400&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg-deep: #0a0b0f;
    --bg-surface: #12131a;
    --bg-card: #181a24;
    --bg-elevated: #1e2030;
    --border: #252838;
    --border-subtle: #1c1e2a;
    --text-primary: #e8e9ed;
    --text-secondary: #8a8d9b;
    --text-muted: #555868;
    --teal: #3ecfb4;
    --teal-dim: #2a9a84;
    --teal-glow: rgba(62, 207, 180, 0.12);
    --amber: #f0a828;
    --amber-dim: #b07a18;
    --amber-glow: rgba(240, 168, 40, 0.10);
    --red: #ef4056;
    --red-dim: #a82a3c;
    --red-glow: rgba(239, 64, 86, 0.10);
    --blue: #5b8af0;
    --blue-glow: rgba(91, 138, 240, 0.10);
    --gray: #6b7080;
    --gray-glow: rgba(107, 112, 128, 0.10);
    --font-display: 'Instrument Serif', Georgia, serif;
    --font-body: 'DM Sans', -apple-system, sans-serif;
    --radius: 10px;
    --radius-sm: 6px;

    /* Stage colors */
    --stage-preseed: #6b7080;
    --stage-seed: #5b8af0;
    --stage-a: #3ecfb4;
    --stage-b: #f0a828;
    --stage-c: #ef4056;
  }

  html {
    font-size: 15px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    background: var(--bg-deep);
    color: var(--text-primary);
    font-family: var(--font-body);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
  }

  .shell {
    max-width: 1320px;
    margin: 0 auto;
    padding: 40px 32px 80px;
  }

  /* --- Header --- */
  .header {
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-bottom: 48px;
    padding-bottom: 28px;
    border-bottom: 1px solid var(--border);
    opacity: 0;
    animation: fadeUp 0.6s ease forwards;
  }
  .header-title {
    font-family: var(--font-display);
    font-size: 2.6rem;
    font-weight: 400;
    letter-spacing: -0.02em;
    line-height: 1.1;
    color: var(--text-primary);
  }
  .header-title em { font-style: italic; color: var(--teal); }
  .header-meta {
    text-align: right;
    font-size: 0.78rem;
    color: var(--text-muted);
    line-height: 1.7;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .header-meta strong { color: var(--text-secondary); font-weight: 500; }

  /* --- Metric Cards --- */
  .metrics-row {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 14px;
    margin-bottom: 40px;
  }
  .metric-card {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
    padding: 22px 20px;
    position: relative;
    overflow: hidden;
    opacity: 0;
    animation: fadeUp 0.5s ease forwards;
  }
  .metric-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }
  .metric-card.teal::before { background: linear-gradient(90deg, var(--teal), transparent); }
  .metric-card.amber::before { background: linear-gradient(90deg, var(--amber), transparent); }
  .metric-card.red::before { background: linear-gradient(90deg, var(--red), transparent); }
  .metric-card.blue::before { background: linear-gradient(90deg, var(--blue), transparent); }
  .metric-card:nth-child(1) { animation-delay: 0.08s; }
  .metric-card:nth-child(2) { animation-delay: 0.14s; }
  .metric-card:nth-child(3) { animation-delay: 0.20s; }
  .metric-card:nth-child(4) { animation-delay: 0.26s; }
  .metric-card:nth-child(5) { animation-delay: 0.32s; }
  .metric-card:nth-child(6) { animation-delay: 0.38s; }
  .metric-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-muted);
    margin-bottom: 10px;
    font-weight: 500;
  }
  .metric-value {
    font-family: var(--font-display);
    font-size: 2.1rem;
    font-weight: 400;
    line-height: 1;
  }
  .metric-value.teal { color: var(--teal); }
  .metric-value.amber { color: var(--amber); }
  .metric-value.red { color: var(--red); }
  .metric-value.blue { color: var(--blue); }
  .metric-sub { font-size: 0.72rem; color: var(--text-muted); margin-top: 6px; }

  /* --- Section Titles --- */
  .section-title {
    font-family: var(--font-display);
    font-size: 1.55rem;
    font-weight: 400;
    margin-bottom: 20px;
    color: var(--text-primary);
    letter-spacing: -0.01em;
  }
  .section-title .num {
    color: var(--text-muted);
    font-family: var(--font-body);
    font-size: 0.8rem;
    font-weight: 500;
    margin-right: 10px;
    letter-spacing: 0.06em;
  }

  /* --- Two Column --- */
  .two-col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 40px;
  }

  /* --- Panel --- */
  .panel {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
    padding: 28px;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards;
    animation-delay: 0.3s;
  }

  /* --- Chart --- */
  .chart-wrap {
    position: relative;
    height: 320px;
    margin-top: 8px;
  }
  .chart-wrap.short { height: 260px; }
  .chart-wrap canvas { width: 100% !important; height: 100% !important; }

  /* --- Full-width panel --- */
  .full-panel {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: var(--radius);
    padding: 28px;
    margin-bottom: 40px;
    opacity: 0;
    animation: fadeUp 0.6s ease forwards;
    animation-delay: 0.35s;
  }

  /* --- Tables --- */
  .data-table { width: 100%; border-collapse: collapse; }
  .data-table thead th {
    text-align: left;
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.07em;
    color: var(--text-muted);
    padding: 16px 16px;
    font-weight: 500;
    background: var(--bg-elevated);
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    user-select: none;
    white-space: nowrap;
  }
  .data-table thead th:hover { color: var(--text-secondary); }
  .data-table thead th.num-col { text-align: right; }
  .data-table tbody td {
    padding: 14px 16px;
    font-size: 0.85rem;
    border-bottom: 1px solid var(--border-subtle);
    color: var(--text-secondary);
    font-variant-numeric: tabular-nums;
  }
  .data-table tbody tr:last-child td { border-bottom: none; }
  .data-table tbody tr:hover { background: rgba(255,255,255,0.015); }
  .data-table td.num-col { text-align: right; }
  .company-name { color: var(--text-primary); font-weight: 600; }

  /* --- Badges --- */
  .stage-badge {
    display: inline-block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 600;
  }
  .stage-badge.pre-seed { background: var(--gray-glow); color: var(--gray); border: 1px solid rgba(107,112,128,0.18); }
  .stage-badge.seed { background: var(--blue-glow); color: var(--blue); border: 1px solid rgba(91,138,240,0.18); }
  .stage-badge.series-a { background: var(--teal-glow); color: var(--teal); border: 1px solid rgba(62,207,180,0.18); }
  .stage-badge.series-b { background: var(--amber-glow); color: var(--amber); border: 1px solid rgba(240,168,40,0.18); }
  .stage-badge.series-c { background: var(--red-glow); color: var(--red); border: 1px solid rgba(239,64,86,0.18); }

  .type-badge {
    display: inline-block;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding: 3px 8px;
    border-radius: 4px;
    font-weight: 600;
    background: var(--blue-glow);
    color: var(--blue);
    border: 1px solid rgba(91,138,240,0.18);
  }
  .type-badge.angel { background: var(--amber-glow); color: var(--amber); border: 1px solid rgba(240,168,40,0.18); }
  .type-badge.cvc { background: var(--teal-glow); color: var(--teal); border: 1px solid rgba(62,207,180,0.18); }

  /* --- Search / Filter Bar --- */
  .filter-bar {
    display: flex;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
    align-items: center;
  }
  .filter-bar input, .filter-bar select {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 8px 14px;
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 0.82rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .filter-bar input:focus, .filter-bar select:focus {
    border-color: var(--teal-dim);
  }
  .filter-bar input { flex: 1; min-width: 200px; }
  .filter-bar select { min-width: 140px; }
  .filter-bar .result-count {
    font-size: 0.72rem;
    color: var(--text-muted);
    margin-left: auto;
    letter-spacing: 0.04em;
  }

  /* --- Pagination --- */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 20px;
    font-size: 0.8rem;
  }
  .pagination button {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 6px 14px;
    color: var(--text-secondary);
    font-family: var(--font-body);
    font-size: 0.78rem;
    cursor: pointer;
    transition: background 0.2s, border-color 0.2s;
  }
  .pagination button:hover:not(:disabled) {
    background: var(--bg-card);
    border-color: var(--teal-dim);
    color: var(--text-primary);
  }
  .pagination button:disabled {
    opacity: 0.3;
    cursor: default;
  }
  .pagination .page-info {
    color: var(--text-muted);
    font-size: 0.72rem;
    letter-spacing: 0.04em;
  }

  /* Sort indicator */
  .sort-arrow { font-size: 0.6rem; margin-left: 4px; opacity: 0.5; }
  .sort-arrow.active { opacity: 1; color: var(--teal); }

  /* --- Footer --- */
  .footer {
    text-align: center;
    font-size: 0.7rem;
    color: var(--text-muted);
    padding-top: 32px;
    border-top: 1px solid var(--border-subtle);
    letter-spacing: 0.04em;
    opacity: 0;
    animation: fadeUp 0.4s ease forwards;
    animation-delay: 0.85s;
  }

  /* --- Animations --- */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* --- Responsive --- */
  @media (max-width: 960px) {
    .metrics-row { grid-template-columns: repeat(3, 1fr); }
    .two-col { grid-template-columns: 1fr; }
  }
  @media (max-width: 600px) {
    .metrics-row { grid-template-columns: repeat(2, 1fr); }
    .header { flex-direction: column; align-items: flex-start; gap: 12px; }
    .header-meta { text-align: left; }
    .shell { padding: 24px 16px 60px; }
    .header-title { font-size: 1.9rem; }
  }
</style>
</head>
<body>
<script>/*__DASHBOARD_DATA__*/</script>
<div class="shell">

  <!-- Header -->
  <header class="header" id="header"></header>

  <!-- Metric Cards -->
  <div class="metrics-row" id="metrics"></div>

  <!-- Funding Trends -->
  <div class="full-panel" style="animation-delay:0.25s;">
    <h2 class="section-title"><span class="num">01</span>Funding Trends by Year</h2>
    <div class="chart-wrap"><canvas id="trendChart"></canvas></div>
  </div>

  <!-- Two Column: Industry + Stage -->
  <div class="two-col">
    <div class="panel" style="animation-delay:0.35s;">
      <h2 class="section-title"><span class="num">02</span>Industry Breakdown</h2>
      <div class="chart-wrap short"><canvas id="industryChart"></canvas></div>
    </div>
    <div class="panel" style="animation-delay:0.4s;">
      <h2 class="section-title"><span class="num">03</span>Stage Distribution</h2>
      <div class="chart-wrap short"><canvas id="stageChart"></canvas></div>
    </div>
  </div>

  <!-- Top Investors -->
  <div class="full-panel" style="animation-delay:0.45s;">
    <h2 class="section-title"><span class="num">04</span>Top Investors</h2>
    <div style="overflow-x:auto;">
      <table class="data-table" id="investorTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Investor</th>
            <th>Type</th>
            <th class="num-col">Companies</th>
            <th class="num-col">Deals</th>
            <th class="num-col">Total Invested</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- Company Explorer -->
  <div class="full-panel" style="animation-delay:0.5s;">
    <h2 class="section-title"><span class="num">05</span>Company Explorer</h2>
    <div class="filter-bar">
      <input type="text" id="searchInput" placeholder="Search companies...">
      <select id="industryFilter"><option value="">All Industries</option></select>
      <select id="stageFilter"><option value="">All Stages</option></select>
      <span class="result-count" id="resultCount"></span>
    </div>
    <div style="overflow-x:auto;">
      <table class="data-table" id="companyTable">
        <thead>
          <tr>
            <th data-sort="name">Company <span class="sort-arrow" id="sort-name"></span></th>
            <th data-sort="industry">Industry <span class="sort-arrow" id="sort-industry"></span></th>
            <th data-sort="headquarters">HQ <span class="sort-arrow" id="sort-headquarters"></span></th>
            <th data-sort="rounds" class="num-col">Rounds <span class="sort-arrow" id="sort-rounds"></span></th>
            <th data-sort="totalFunding" class="num-col">Total Funding <span class="sort-arrow" id="sort-totalFunding"></span></th>
            <th data-sort="latestStage">Latest Stage <span class="sort-arrow" id="sort-latestStage"></span></th>
            <th data-sort="latestValuation" class="num-col">Valuation <span class="sort-arrow" id="sort-latestValuation"></span></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="pagination" id="pagination"></div>
  </div>

  <!-- Footer -->
  <div class="footer" id="footer"></div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const D = window.DASHBOARD_DATA;
  if (!D) return;

  // --- Helpers ---
  function fmt$(n) {
    if (n == null) return '—';
    if (n >= 1e9) return '$' + (n / 1e9).toFixed(2) + 'B';
    if (n >= 1e6) return '$' + (n / 1e6).toFixed(1) + 'M';
    if (n >= 1e3) return '$' + (n / 1e3).toFixed(0) + 'K';
    return '$' + n.toLocaleString();
  }
  function fmtNum(n) { return n != null ? n.toLocaleString() : '—'; }
  function stageBadgeClass(stage) {
    if (!stage) return '';
    return stage.toLowerCase().replace(/\s+/g, '-').replace('/', '-');
  }
  function stageColor(stage) {
    const map = { 'Pre-Seed': '#6b7080', 'Seed': '#5b8af0', 'Series A': '#3ecfb4', 'Series B': '#f0a828', 'Series C': '#ef4056' };
    return map[stage] || '#6b7080';
  }
  function typeBadgeClass(type) {
    if (!type) return '';
    if (type.toLowerCase().includes('angel')) return 'angel';
    if (type.toLowerCase().includes('cvc') || type.toLowerCase().includes('corporate')) return 'cvc';
    return '';
  }

  // --- Header ---
  const o = D.overview;
  document.getElementById('header').innerHTML = `
    <h1 class="header-title">Startup <em>Funding</em><br>Dashboard</h1>
    <div class="header-meta">
      <strong>Generated</strong> ${new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}<br>
      <strong>Range</strong> ${o.minDate?.slice(0,7)} — ${o.maxDate?.slice(0,7)}<br>
      <strong>Startups</strong> ${o.totalStartups} &middot; <strong>Rounds</strong> ${o.totalRounds} &middot; <strong>Investors</strong> ${o.totalInvestors}
    </div>
  `;

  // --- Metric Cards ---
  const totalFundingB = (o.totalFunding / 1e9).toFixed(2);
  const avgDealM = (o.avgDealSize / 1e6).toFixed(1);
  const avgValM = (o.avgValuation / 1e6).toFixed(1);
  document.getElementById('metrics').innerHTML = `
    <div class="metric-card teal">
      <div class="metric-label">Total Startups</div>
      <div class="metric-value teal" data-count="${o.totalStartups}" data-suffix="" data-decimals="0">0</div>
      <div class="metric-sub">unique companies</div>
    </div>
    <div class="metric-card teal">
      <div class="metric-label">Total Funding</div>
      <div class="metric-value teal" data-count="${totalFundingB}" data-prefix="$" data-suffix="B" data-decimals="2">0</div>
      <div class="metric-sub">across all rounds</div>
    </div>
    <div class="metric-card blue">
      <div class="metric-label">Deal Count</div>
      <div class="metric-value blue" data-count="${o.totalRounds}" data-suffix="" data-decimals="0">0</div>
      <div class="metric-sub">funding rounds</div>
    </div>
    <div class="metric-card amber">
      <div class="metric-label">Avg Deal Size</div>
      <div class="metric-value amber" data-count="${avgDealM}" data-prefix="$" data-suffix="M" data-decimals="1">0</div>
      <div class="metric-sub">per round</div>
    </div>
    <div class="metric-card red">
      <div class="metric-label">Top Industry</div>
      <div class="metric-value red" style="font-size:1.5rem;line-height:1.2;">${o.topIndustry}</div>
      <div class="metric-sub">by total funding</div>
    </div>
    <div class="metric-card blue">
      <div class="metric-label">Avg Valuation</div>
      <div class="metric-value blue" data-count="${avgValM}" data-prefix="$" data-suffix="M" data-decimals="1">0</div>
      <div class="metric-sub">at funding</div>
    </div>
  `;

  // --- Animated counters ---
  const duration = 1400;
  setTimeout(() => {
    document.querySelectorAll('.metric-value[data-count]').forEach(el => {
      const target = parseFloat(el.dataset.count);
      const decimals = el.dataset.decimals !== undefined ? parseInt(el.dataset.decimals) : 1;
      const prefix = el.dataset.prefix || '';
      const suffix = el.dataset.suffix !== undefined ? el.dataset.suffix : '';
      const start = performance.now();
      function tick(now) {
        const elapsed = now - start;
        const progress = Math.min(elapsed / duration, 1);
        const ease = 1 - Math.pow(1 - progress, 3);
        const current = target * ease;
        let display = decimals > 0 ? current.toFixed(decimals) : Math.round(current).toLocaleString();
        el.textContent = prefix + display + suffix;
        if (progress < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    });
  }, 500);

  // --- Chart.js defaults ---
  Chart.defaults.color = '#555868';
  Chart.defaults.font.family = "'DM Sans', sans-serif";
  Chart.defaults.font.size = 11;
  Chart.defaults.plugins.legend.display = false;
  Chart.defaults.scale.grid = { color: 'rgba(255,255,255,0.04)', drawBorder: false };

  // --- Funding Trends (stacked bar) ---
  const stages = ['Pre-Seed', 'Seed', 'Series A', 'Series B', 'Series C'];
  const yearSet = [...new Set(D.fundingByYearStage.map(r => r.year))].sort();
  const datasets = stages.map(stage => ({
    label: stage,
    data: yearSet.map(y => {
      const row = D.fundingByYearStage.find(r => r.year === y && r.stage === stage);
      return row ? row.total / 1e6 : 0;
    }),
    backgroundColor: stageColor(stage) + 'cc',
    borderColor: stageColor(stage),
    borderWidth: 1,
    borderRadius: 3,
  }));

  new Chart(document.getElementById('trendChart'), {
    type: 'bar',
    data: { labels: yearSet, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { stacked: true },
        y: {
          stacked: true,
          ticks: { callback: v => '$' + v + 'M' },
          title: { display: true, text: 'Funding ($M)', color: '#555868' }
        }
      },
      plugins: {
        legend: { display: true, position: 'top', labels: { boxWidth: 12, padding: 16, usePointStyle: true, pointStyle: 'rectRounded' } },
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.dataset.label}: $${ctx.parsed.y.toFixed(1)}M`
          }
        }
      }
    }
  });

  // --- Industry Breakdown (horizontal bar) ---
  const indData = D.industryBreakdown.slice(0, 12);
  new Chart(document.getElementById('industryChart'), {
    type: 'bar',
    data: {
      labels: indData.map(r => r.industry),
      datasets: [{
        data: indData.map(r => r.total / 1e6),
        backgroundColor: '#3ecfb4aa',
        borderColor: '#3ecfb4',
        borderWidth: 1,
        borderRadius: 3,
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { ticks: { callback: v => '$' + v + 'M' } },
        y: { ticks: { font: { size: 10 } } }
      },
      plugins: {
        tooltip: { callbacks: { label: ctx => '$' + ctx.parsed.x.toFixed(1) + 'M (' + indData[ctx.dataIndex].deals + ' deals)' } }
      }
    }
  });

  // --- Stage Distribution (doughnut) ---
  const stageData = D.stageDistribution;
  new Chart(document.getElementById('stageChart'), {
    type: 'doughnut',
    data: {
      labels: stageData.map(r => r.stage),
      datasets: [{
        data: stageData.map(r => r.count),
        backgroundColor: stageData.map(r => stageColor(r.stage) + 'cc'),
        borderColor: stageData.map(r => stageColor(r.stage)),
        borderWidth: 2,
        hoverOffset: 6,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '55%',
      plugins: {
        legend: { display: true, position: 'bottom', labels: { boxWidth: 12, padding: 14, usePointStyle: true, pointStyle: 'circle' } },
        tooltip: {
          callbacks: {
            label: ctx => {
              const row = stageData[ctx.dataIndex];
              return `${row.stage}: ${row.count} rounds — $${(row.total / 1e6).toFixed(1)}M total`;
            }
          }
        }
      }
    }
  });

  // --- Top Investors Table ---
  const invTbody = document.querySelector('#investorTable tbody');
  D.topInvestors.forEach((inv, i) => {
    const tr = document.createElement('tr');
    const typeCls = typeBadgeClass(inv.type);
    tr.innerHTML = `
      <td style="color:var(--text-muted);font-size:0.78rem;">${i + 1}</td>
      <td><span class="company-name">${inv.name}</span></td>
      <td><span class="type-badge ${typeCls}">${inv.type || '—'}</span></td>
      <td class="num-col">${inv.companies}</td>
      <td class="num-col">${inv.deals}</td>
      <td class="num-col">${fmt$(inv.totalInvested)}</td>
    `;
    invTbody.appendChild(tr);
  });

  // --- Company Explorer ---
  let companies = D.companies.slice();
  let filtered = companies.slice();
  let sortCol = 'totalFunding';
  let sortDir = 'desc';
  const PAGE_SIZE = 25;
  let currentPage = 1;

  // Populate filter dropdowns
  const industries = [...new Set(companies.map(c => c.industry))].sort();
  const industrySelect = document.getElementById('industryFilter');
  industries.forEach(ind => {
    const opt = document.createElement('option');
    opt.value = ind; opt.textContent = ind;
    industrySelect.appendChild(opt);
  });
  const stageSelect = document.getElementById('stageFilter');
  stages.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s; opt.textContent = s;
    stageSelect.appendChild(opt);
  });

  const stageOrder = { 'Pre-Seed': 1, 'Seed': 2, 'Series A': 3, 'Series B': 4, 'Series C': 5 };

  function applyFilters() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    const ind = industrySelect.value;
    const stg = stageSelect.value;
    filtered = companies.filter(c => {
      if (q && !c.name.toLowerCase().includes(q) && !(c.industry || '').toLowerCase().includes(q) && !(c.headquarters || '').toLowerCase().includes(q)) return false;
      if (ind && c.industry !== ind) return false;
      if (stg && c.latestStage !== stg) return false;
      return true;
    });
    sortCompanies();
    currentPage = 1;
    renderCompanyTable();
  }

  function sortCompanies() {
    filtered.sort((a, b) => {
      let av = a[sortCol], bv = b[sortCol];
      if (sortCol === 'latestStage') { av = stageOrder[av] || 0; bv = stageOrder[bv] || 0; }
      if (av == null) av = sortCol === 'name' || sortCol === 'industry' || sortCol === 'headquarters' ? '' : 0;
      if (bv == null) bv = sortCol === 'name' || sortCol === 'industry' || sortCol === 'headquarters' ? '' : 0;
      if (typeof av === 'string') { av = av.toLowerCase(); bv = (bv || '').toLowerCase(); }
      if (av < bv) return sortDir === 'asc' ? -1 : 1;
      if (av > bv) return sortDir === 'asc' ? 1 : -1;
      return 0;
    });
  }

  function renderCompanyTable() {
    const tbody = document.querySelector('#companyTable tbody');
    tbody.innerHTML = '';
    const start = (currentPage - 1) * PAGE_SIZE;
    const page = filtered.slice(start, start + PAGE_SIZE);
    page.forEach(c => {
      const tr = document.createElement('tr');
      const cls = stageBadgeClass(c.latestStage);
      tr.innerHTML = `
        <td><span class="company-name">${c.name}</span></td>
        <td>${c.industry || '—'}</td>
        <td style="font-size:0.78rem;">${c.headquarters || '—'}</td>
        <td class="num-col">${c.rounds}</td>
        <td class="num-col">${fmt$(c.totalFunding)}</td>
        <td><span class="stage-badge ${cls}">${c.latestStage || '—'}</span></td>
        <td class="num-col">${fmt$(c.latestValuation)}</td>
      `;
      tbody.appendChild(tr);
    });
    document.getElementById('resultCount').textContent = `${filtered.length} of ${companies.length} companies`;

    // Update sort arrows
    document.querySelectorAll('.sort-arrow').forEach(el => {
      el.textContent = '';
      el.classList.remove('active');
    });
    const activeArrow = document.getElementById('sort-' + sortCol);
    if (activeArrow) {
      activeArrow.textContent = sortDir === 'asc' ? ' \u25B2' : ' \u25BC';
      activeArrow.classList.add('active');
    }

    renderPagination();
  }

  function renderPagination() {
    const totalPages = Math.ceil(filtered.length / PAGE_SIZE);
    const pag = document.getElementById('pagination');
    if (totalPages <= 1) { pag.innerHTML = ''; return; }
    pag.innerHTML = `
      <button id="prevPage" ${currentPage === 1 ? 'disabled' : ''}>Prev</button>
      <span class="page-info">Page ${currentPage} of ${totalPages}</span>
      <button id="nextPage" ${currentPage === totalPages ? 'disabled' : ''}>Next</button>
    `;
    document.getElementById('prevPage').addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderCompanyTable(); } });
    document.getElementById('nextPage').addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; renderCompanyTable(); } });
  }

  // Sort headers
  document.querySelectorAll('#companyTable thead th[data-sort]').forEach(th => {
    th.addEventListener('click', () => {
      const col = th.dataset.sort;
      if (sortCol === col) { sortDir = sortDir === 'asc' ? 'desc' : 'asc'; }
      else { sortCol = col; sortDir = col === 'name' || col === 'industry' || col === 'headquarters' ? 'asc' : 'desc'; }
      sortCompanies();
      currentPage = 1;
      renderCompanyTable();
    });
  });

  // Filter listeners
  document.getElementById('searchInput').addEventListener('input', applyFilters);
  industrySelect.addEventListener('change', applyFilters);
  stageSelect.addEventListener('change', applyFilters);

  // Initial render
  sortCompanies();
  renderCompanyTable();

  // --- Footer ---
  document.getElementById('footer').innerHTML =
    `Generated by Claude Code &middot; Source: startup-funding.db &middot; ${o.totalStartups} startups &middot; ${o.totalRounds} rounds &middot; ${o.totalInvestors} investors &middot; ${o.minDate?.slice(0,7)} — ${o.maxDate?.slice(0,7)}`;
});
</script>
</body>
</html>
